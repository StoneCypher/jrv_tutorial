<!doctype html>
<html>

  <head>

    <link rel="stylesheet" type="text/css" href="../common/basic.css">
    <link rel="stylesheet" type="text/css" href="../common/solarized-dark.css">

    <script type="text/javascript" src="jrv.js"></script>
    <script type="text/javascript" src="../common/highlight.pack.js"></script>
    <script type="text/javascript" src="../common/colorize.js"></script>

  </head>

  <body>

- also means no basic variables anymore - todo whargarbl

    <h1>Step 3 "Update and Cache"</h1>

    <p><a href="../2_mutable_jrv/index.html">2: Mutable JRV (prev)</a> or <a href="../4_dirty_and_lazy/index.html">4: Dirty and Lazy (next)</a></p>

    <p>This is a demonstration of step three "not redoing a zillion steps every time" Reactive,
    from <a href="https://github.com/StoneCypher/UnderstandingReactiveProgramming/tree/master">Understanding
    Reactive Programming</a>.

    <h2>Usage instructions</h2>

    <pre><code class="javascript">
var A = new JRV(0),
    B = new JRV(5),
    X = new JRV( () => A.v + B.v );

console.log( X.v );

A.v = 10; console.log( X.v );
A.v = 20; console.log( X.v );
A.v = 30; console.log( X.v );
</code></pre></code></pre>

    <h2>Challenge</h2>

    <pre><code class="javascript">
</code></pre>

    <h2>Current implementation</h2>

    The current code:

    <pre><code class="javascript">
class JRV {

    constructor(comp) {
        this.comp      = comp;
        this.callbacks = [];
        this.update();
    }

    should_notify(cb) {
        this.callbacks = this.callbacks.concat(cb);
    }

    make_notifier() {
        return (() => this.update());
    }

    set v(newComp) {
        this.comp = newComp;
        this.update();
        this.callbacks.map(cb => cb());
    }

    get v() {
        return this.value;
    }

    update() {
        var isFunc        = (typeof this.comp === 'function');
        return this.value = (isFunc? this.comp() : this.comp);
    }

}
</code></pre>

    <p><a href="../2_mutable_jrv/index.html">2: Mutable JRV (prev)</a> or <a href="../4_dirty_and_lazy/index.html">4: Dirty and Lazy (next)</a></p>

  </body>

</html>